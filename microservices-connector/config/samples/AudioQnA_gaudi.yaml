# Copyright (C) 2024 Intel Corporation
# SPDX-License-Identifier: Apache-2.0

apiVersion: gmc.opea.io/v1alpha3
kind: GMConnector
metadata:
  labels:
    app.kubernetes.io/name: gmconnector
    app.kubernetes.io/managed-by: kustomize
    gmc/platform: gaudi
  name: audioqa
  namespace: audioqa-gaudi
spec:
  routerConfig:
    name: router
    serviceName: router-service
  nodes:
    root:
      routerType: Sequence
      steps:
      - name: WhisperGaudi
        internalService:
          serviceName: whisper-gaudi-svc
          config:
            endpoint: /v1/asr
          isDownstreamService: true
      - name: ASR
        internalService:
          serviceName: asr-svc
          config:
            endpoint: /v1/audio/transcriptions
            ASR_ENDPOINT: whisper-gaudi-svc
      - name: Tgi
        internalService:
          serviceName: tgi-svc
          config:
            endpoint: /generate
            MODEL_ID: Intel/neural-chat-7b-v3-3
          isDownstreamService: true
      - name: Llm
        data: $response
        internalService:
          serviceName: llm-svc
          config:
            endpoint: /v1/chat/completions
            TGI_LLM_ENDPOINT: tgi-svc
      - name: SpeechT5Gaudi
        internalService:
          serviceName: speecht5-gaudi-svc
          config:
            endpoint: /v1/tts
          isDownstreamService: true
      - name: TTS
        data: $response
        internalService:
          serviceName: tts-svc
          config:
            endpoint: /v1/audio/speech
            TTS_ENDPOINT: speecht5-gaudi-svc
